<script>
  function getQueryParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
  }
  const amount = getQueryParam('amount');
  const clientToken = getQueryParam('token');
  document.getElementById('amount-display').innerText = amount ? `Amount: ${amount} RSD` : 'Amount: RSD';

  braintree.dropin.create({
    authorization: clientToken,
    container: '#dropin-container',
    card: {
      cardholderName: {
        required: true
      }
    }
  }, function (createErr, instance) {
    if (createErr) {
      alert('Error loading payment form: ' + createErr.message);
      return;
    }
    document.getElementById('submit-button').addEventListener('click', function () {
      instance.requestPaymentMethod(function (err, payload) {
        if (err) {
          alert('Payment method error: ' + err.message);
          return;
        }
        // Send the nonce back to React Native
        if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
          window.ReactNativeWebView.postMessage(payload.nonce);
        } else {
          alert('WebView bridge not found.');
        }
      });
    });
  });
</script>
